<app-header></app-header>
<div class="container-scroller">
  <div class="container-fluid page-body-wrapper">
    <app-navbar-placement></app-navbar-placement>
    <div class="main-panel">
      <div class="content-wrapper">
        <div class="row">
          <div class="col-md-12 grid-margin">
            <div class="row">
              <div class="col-12 col-xl-8 mb-4 mb-xl-0">
                <h2 class="font-weight-bold">Tableau de bord des placements</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 grid-margin transparent">
            <div class="row">
              <div class="col-md-12 mb-4 stretch-card transparent">
                <div class="card card-tale">
                  <div class="card-body" (click)="changeViewCard('')">
                    <p class="mb-4">Totale Montant Dépôt</p>
                    <p class="fs-40 mb-2">
                      {{ this.montantPlacementGlobal | number: "1.4-4" }} DT
                    </p>
                    <p>
                      Total des placements :
                      <b> {{ this.nbrePlacementGlobal }} </b>
                    </p>
                  </div>
                </div>
              </div>
              <!--
                            <div class="col-md-6 mb-4 stretch-card transparent">
                              <div class="card card-dark-blue">
                                <div class="card-body">
                                  <p class="mb-4"></p>
                                </div>
                              </div>
                            </div>
                            -->
            </div>

            <div class="row">
              <div class="col-md-6 mb-4 mb-lg-0 stretch-card transparent">
                <div class="card card-light-danger">
                  <div
                    class="card-body"
                    (click)="changeViewCard('PlacementFinancierView')"
                  >
                    <a
                      class="carousel-control-next"
                      role="button"
                      data-slide="next"
                    >
                      <span
                        class="carousel-control-next-icon"
                        aria-hidden="true"
                      ></span>
                      <span class="sr-only"></span>
                    </a>

                    <p class="mb-4">
                      Total Montant : <b>{{ listTypePlacementLibelle[0] }}</b>
                    </p>
                    <p class="fs-40 mb-2">
                      {{ montantPlacementByType[0] | number: "1.3-3" }} DT
                    </p>
                    <p>
                      Total des placements :
                      <b> {{ nbrePlacementByType[0] }}</b>
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-md-6 stretch-card transparent">
                <div class="card card-light-blue">
                  <div class="card-body" (click)="changeViewCard('')">
                    <p class="mb-4">
                      Total Montant : <b>{{ listTypePlacementLibelle[1] }} </b>
                    </p>
                    <p class="fs-40 mb-2">
                      {{ montantPlacementByType[1] | number: "1.3-3" }} DT
                    </p>
                    <p>
                      Total des placements :
                      <b>{{ nbrePlacementByType[1] }} </b>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--Profit ppc jour / ppc fin année comptable / ppc fin trimestre comptable-->

          <div class="col-md-6 grid-margin transparent">
            <div class="row">
              <div class="col-md-12 mb-4 stretch-card transparent">
                <div class="card card-table2">
                  <div class="card-body" (click)="changeViewCard('')">
                    <p class="mb-4">
                      Total rémunération des placements financiers à la date du
                      jour : <b> {{ getTodayDate() | date: "dd/MM/yyyy" }}</b>
                    </p>
                    <p class="fs-40 mb-2">
                      {{
                        this.varTotalRemunerationDateDuJour | number: "1.3-3"
                      }}
                      DT
                    </p>
                    <br />
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-4 mb-lg-0 stretch-card transparent">
                <div class="card card-light-danger">
                  <div class="card-body">
                    <p class="mb-4">
                      Total rémunération des placements financiers à la fin du
                      prochain <b>trimestre comptable</b>.
                    </p>
                    <p class="fs-40 mb-2">
                      {{ this.varTotalRemunerationTrimestre | number: "1.3-3" }}
                      DT
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-md-6 stretch-card transparent">
                <div class="card card-light-blue">
                  <div class="card-body">
                    <p class="mb-4">
                      Total rémunération des placements financiers à la fin de
                      la <b>l'année comptable</b>
                    </p>
                    <p class="fs-40 mb-2">
                      {{ this.varTotalRemunerationAnnee | number: "1.3-3" }} DT
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- END Profit ppc jour / ppc fin année comptable / ppc fin trimestre comptable-->

          <ng-container *ngIf="changeView == 'PlacementFinancierView'">
            <div class="col-md-6 grid-margin transparent">
              <div class="row">
                <!--Placement Financier-->
                <ng-container
                  *ngFor="let item of listActionLibelle; let i = index"
                >
                  <div class="col-md-6 mb-4 stretch-card transparent">
                    <div class="card card-light-danger">
                      <div class="card-body">
                        <p class="mb-4">
                          <b>{{ listActionLibelle[i] }} </b>
                        </p>
                        <p class="fs-40 mb-2">
                          {{ montantPlacementByAction[i] | number: "1.3-3" }} DT
                        </p>
                        <p>
                          Total des placements :
                          <b>{{ nbrePlacementByAction[i] }} </b>
                        </p>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <!-- END TEST-->
              </div>
            </div>
          </ng-container>
        </div>

        <div class="row">
          <div class="col-lg-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <div class="chartjs-size-monitor">
                  <div class="chartjs-size-monitor-expand">
                    <div class=""></div>
                  </div>
                  <div class="chartjs-size-monitor-shrink">
                    <div class=""></div>
                  </div>
                </div>
                <p class="card-title">Montant Dépôt / Banques</p>
                <p class="font-weight-500">
                  Montant total des investissements répartis entre les banques
                </p>
                <canvas
                  id="BarChart"
                  width="351"
                  height="150"
                  class="chartjs-render-monitor"
                ></canvas>
              </div>
            </div>
          </div>

          <div class="col-lg-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <div class="chartjs-size-monitor">
                  <div class="chartjs-size-monitor-expand">
                    <div class=""></div>
                  </div>
                  <div class="chartjs-size-monitor-shrink">
                    <div class=""></div>
                  </div>
                </div>
                <p class="card-title">Taux profit moyen / Banques</p>
                <p class="font-weight-500">
                  Le taux de profit moyen des investissements par banque
                </p>
                <canvas
                  id="BarChartTaux"
                  width="351"
                  height="150"
                  class="chartjs-render-monitor"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
        <!--
                    <div class="row">
                      <div class="col-lg-6 grid-margin stretch-card" >
                  
                        <div class="card">
                          <div class="card-body"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
                            
                            <p class="card-title">Nombre de placements / Banques</p>
                            <div style="width:200px; height:350px;">
                              <canvas id="PieChartCountBanque"  ></canvas>
                            </div>
                           </div>
                        </div>
                      </div>
                    </div>
                  -->
        <div class="row col-lg-6">
          <div class="card">
            <div class="card-body">
              <div class="chartjs-size-monitor">
                <div class="chartjs-size-monitor-expand">
                  <div class=""></div>
                </div>
                <div class="chartjs-size-monitor-shrink"></div>
              </div>
              <p class="card-title">Nombre de placements / Banques</p>
              <p class="font-weight-500">
                Le nombre de placements répartis entre les banques
              </p>
              <canvas
                id="PieChartCountBanque"
                width="400"
                height="150"
                class="chartjs-render-monitor"
              ></canvas>
            </div>
          </div>
        </div>

        <br />
    
        <div class="row">
          <div class="col-md-12 grid-margin">
            <div class="row">
              <div class="col-12 col-xl-8 mb-4 mb-xl-0">
                
                <!-- Filtre Séléction : -->
                <table class="table table-borderless">
                  <tr>
                  <td>
                  
                  <select  class="form-control form-control-lg"   [(ngModel)]="this.searchDisplayingFilter" (change)="selectedFilterTable()">
                    <option value=0 disabled selected> <i class="bi bi-filter"></i> Choisissez les critères de sélection</option>
                    <option value=1 selected> Sélectionnez par type placement </option>
                    <option value=2 selected> Sélectionnez par institution financière  </option>
                  </select>
                  </td> 
                  <td>
                <!-- Filtre Séléction : -->
                 
                  <select *ngIf="this.searchDisplayingFilter ==1"
                    class="form-control form-control-lg"
                    [(ngModel)]="this.typePlacement"
                    name="typePlacement"
                    (change)="selectedValue()"
                  >
                    <option value="0" selected>
                    Sélectionner type placement
                    </option>
                    <ng-container
                      *ngFor="
                        let item of this.typePlacementService.listtypeplacement
                      "
                    >
                      <option disabled style="color: rgb(63, 40, 48)">
                        {{ item.typ_pla_libelle }}
                      </option>
                      <ng-container
                        *ngFor="let item2 of this.typeFondService.listtypefond"
                      >
                        <option
                          [disabled]="item.typ_pla_id === 1"
                          value="{{ item.typ_pla_id }}+{{
                            item2.typ_fon_id
                          }}+0+0+0"
                          style="color: rgb(248, 155, 58)"
                        >
                          &nbsp; &nbsp; {{ item2.type_fon_libelle }}
                        </option>
                        <ng-container
                          *ngFor="
                            let item3 of this.typeSousPlacementService
                              .listtypeSplacement
                          "
                        >
                          <ng-container
                            *ngIf="
                              item.typ_pla_id === 1 &&
                              item2.typ_fon_id == 1 &&
                              (item3.typ_sous_pla_id == 1 ||
                                item3.typ_sous_pla_id == 2)
                            "
                          >
                            <option
                              style="color: #009161"
                              value="{{ item.typ_pla_id }}+{{
                                item2.typ_fon_id
                              }}+{{ item3.typ_sous_pla_id }}+0+0"
                            >
                              &nbsp; &nbsp;&nbsp;&nbsp;
                              {{ item3.typ_sous_pla_libelle }}
                            </option>
                            <!--Action : Contrats Moudharba / Titres Participatifs / Contrats Istithmar ... -->
                            <ng-container
                              *ngFor="
                                let item5 of this.typeActionServicer.listaction
                              "
                            >
                              <option
                                value="{{ item.typ_pla_id }}+{{
                                  item2.typ_fon_id
                                }}+{{ item3.typ_sous_pla_id }}+0+{{
                                  item5.typ_act_id
                                }}"
                              >
                                &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
                                {{ item5.typ_act_libelle }}
                              </option>
                            </ng-container>
                          </ng-container>
                          <ng-container
                            *ngIf="
                              item.typ_pla_id === 1 &&
                              item2.typ_fon_id == 2 &&
                              (item3.typ_sous_pla_id == 3 ||
                                item3.typ_sous_pla_id == 4)
                            "
                          >
                            <option
                              style="color: #009161"
                              value="{{ item.typ_pla_id }}+{{
                                item2.typ_fon_id
                              }}+{{ item3.typ_sous_pla_id }}+0+0"
                            >
                              &nbsp; &nbsp;&nbsp;&nbsp;
                              {{ item3.typ_sous_pla_libelle }}
                            </option>
                            <!--Prévoyance & capitalisation-->
                            <ng-container
                              *ngFor="
                                let item4 of this.typeSousSousPlacementService
                                  .listtypeSSplacement
                              "
                            >
                              <option
                                style="color: #1ab7ea"
                                value="{{ item.typ_pla_id }}+{{
                                  item2.typ_fon_id
                                }}+{{ item3.typ_sous_pla_id }}+{{
                                  item4.type_s_sous_plac_id
                                }}+0"
                                *ngIf="
                                  item3.typ_sous_pla_id === 3 &&
                                  (item4.type_s_sous_plac_id == 1 ||
                                    item4.type_s_sous_plac_id == 2)
                                "
                              >
                                &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
                                {{ item4.type_s_sous_plac_libelle }}
                              </option>
                              <!--Action : Contrats Moudharba / Titres Participatifs / Contrats Istithmar ... -->
                              <ng-container
                                *ngIf="
                                  item3.typ_sous_pla_id === 3 &&
                                  (item4.type_s_sous_plac_id == 1 ||
                                    item4.type_s_sous_plac_id == 2)
                                "
                              >
                                <ng-container
                                  *ngFor="
                                    let item5 of this.typeActionServicer
                                      .listaction
                                  "
                                >
                                  <option
                                    value="{{ item.typ_pla_id }}+{{
                                      item2.typ_fon_id
                                    }}+{{ item3.typ_sous_pla_id }}+{{
                                      item4.type_s_sous_plac_id
                                    }}+{{ item5.typ_act_id }}"
                                  >
                                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                    &nbsp;&nbsp;&nbsp; {{ item5.typ_act_libelle }}
                                  </option>
                                </ng-container>
                              </ng-container>
                            </ng-container>
                          </ng-container>
                          <ng-container
                            *ngIf="
                              item.typ_pla_id === 1 &&
                              item2.typ_fon_id == 2 &&
                              item3.typ_sous_pla_id == 5
                            "
                          >
                            <ng-container
                              *ngFor="
                                let item5 of this.typeActionServicer.listaction
                              "
                            >
                              <option
                                value="{{ item.typ_pla_id }}+{{
                                  item2.typ_fon_id
                                }}+{{ item3.typ_sous_pla_id }}+0+{{
                                  item5.typ_act_id
                                }}"
                              >
                                &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
                                {{ item5.typ_act_libelle }}
                              </option>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </select>

                  <select *ngIf="this.searchDisplayingFilter==2"  class="form-control form-control-lg" >
                    <ng-container *ngFor="let i of this.organismeService.listorganisme" >
                      <option value=" i.org_id"> {{i.org_libelle}} </option>
                  </ng-container>
                  </select>

                </td>
                </tr>
              </table>
              </div>
              <div class="col-12 col-xl-4">
                <div class="justify-content-end d-flex">
                  <div class="dropdown flex-md-grow-1 flex-xl-grow-0">
                    <button
                      class="btn btn-sm btn-light bg-white save-toggle"
                      type="button"
                      aria-haspopup="true"
                      aria-expanded="true"
                    >
                      <i class="bi bi-download"></i> Exporter
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--Table-->
        <div class="row">
          <div class="col-md-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <p class="card-title">Placements</p>
                <div class="row">
                  <div class="col-12">
                    <div class="table-responsive">
                      <div
                        id="example_wrapper"
                        class="dataTables_wrapper dt-bootstrap4 no-footer"
                      >
                        <div class="row">
                          <div class="col-sm-12 col-md-6"></div>
                          <div class="col-sm-12 col-md-6"></div>
                        </div>
                        <div class="row">
                          <div class="col-sm-12">
                            <ng-container *ngIf="listPlacement.length > 0">
                              <table
                                id="example"
                                class="display expandable-table dataTable no-footer"
                                style="width: 100%"
                                role="grid"
                              >
                                <thead>
                                  <tr role="row">
                                    <th
                                      *ngFor="let item of displayedColumns"
                                      class="select-checkbox sorting_disabled"
                                      rowspan="1"
                                      colspan="1"
                                      style="width: 66px"
                                    >
                                      {{ item }}
                                    </th>
                                    <th
                                      class="details-control sorting_disabled"
                                      rowspan="1"
                                      colspan="1"
                                      aria-label=""
                                      style="width: 5px"
                                    ></th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr
                                    *ngFor="let item of listPlacement"
                                    class="odd"
                                  >
                                    <ng-container
                                      *ngIf="
                                        this.displayedRowsSelected ==
                                        'Action1-5'
                                      "
                                    >
                                      <td>{{ item.pla_societe }}</td>
                                      <td>{{ item.pla_nbr_action }}</td>
                                      <td>{{ item.pla_prix_achat }}</td>
                                      <td>{{ item.pla_montant_depot }}</td>
                                      <td>{{ item.pla_date_souscription }}</td>
                                      <td>{{ item.pla_montant_actualise }}</td>
                                      <td>
                                        {{ item.pla_value_consome_date_jour }}
                                      </td>
                                      <td>
                                        {{
                                          item.pla_value_consome_trimestre_comptable
                                        }}
                                      </td>
                                      <td>
                                        {{
                                          item.pla_value_consome_annee_comptable
                                        }}
                                      </td>
                                    </ng-container>
                                  </tr>
                                  <tr *ngIf="listPlacement.length > 0">
                                    <td
                                      valign="top"
                                      colspan="8"
                                      class="dataTables_empty"
                                    >
                                      <b>Total Montant Placement</b>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </ng-container>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-12 col-md-5"></div>
                          <div class="col-sm-12 col-md-7"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
